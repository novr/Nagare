# カスタムSuperset Dockerfile
# PostgreSQLドライバーを含むSupersetイメージ

FROM apache/superset:latest

USER root

# PostgreSQLドライバーをシステムpipでインストール
RUN pip3 install --no-cache-dir psycopg2-binary

# Pythonバージョンを動的に取得してシンボリックリンクを作成
RUN PYTHON_VERSION=$(/app/.venv/bin/python -c "import sys; print(f'{sys.version_info.major}.{sys.version_info.minor}')") && \
    ln -sf /usr/local/lib/python${PYTHON_VERSION}/site-packages/psycopg2* /app/.venv/lib/python${PYTHON_VERSION}/site-packages/

USER superset
