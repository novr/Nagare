# =============================================================================
# Nagare 環境変数設定
# =============================================================================
#
# このファイルは環境変数のテンプレートです。
# 実際の環境では以下の手順でセットアップしてください。
#
# セットアップ手順:
#   1. cp .env.sample .env
#   2. ./scripts/setup-secrets.sh を実行（パスワード自動生成）
#   3. .env を編集して GITHUB_TOKEN と AIRFLOW_ADMIN_PASSWORD を設定
#
# ⚠️  セキュリティ重要事項:
#   - .envファイルは.gitignoreに含まれています（コミット禁止）
#   - 本番環境ではSecrets Managerの使用を推奨
#   - パスワードは16文字以上の強力なものを使用
#   - 定期的なトークンのローテーションを実施
#
# 📚 関連ドキュメント:
#   - Connection管理: docs/02_design/adr/002-connection-management-architecture.md
#   - 設定ファイル版: connections.yml.sample（環境変数の代替）
#
# 💡 ヒント:
#   Docker環境では、DATABASE_HOST等の設定は不要です（docker-compose.ymlで管理）。
#   ローカル開発環境で必要な場合は、個別に追加してください。
#
# =============================================================================


# =============================================================================
# 1. GitHub認証（必須）
# =============================================================================
#
# NagareはGitHub APIを使用してCI/CDデータを収集します。
# 以下のいずれかの認証方法を設定してください。
#
# 📖 詳細: https://docs.github.com/en/authentication

# -----------------------------------------------------------------------------
# 1-1. Personal Access Token認証（推奨）
# -----------------------------------------------------------------------------
#
# 取得方法:
#   1. GitHub → Settings → Developer settings
#   2. Personal access tokens → Tokens (classic)
#   3. Generate new token (classic)
#
# 必要な権限（Scopes）:
#   ✅ repo            - リポジトリ情報の読み取り
#   ✅ read:org        - 組織情報の読み取り（組織のリポジトリを監視する場合）
#   ✅ workflow        - GitHub Actionsのワークフロー情報
#
# セキュリティ:
#   - Fine-grained tokensの使用を検討（より細かい権限制御）
#   - 有効期限の設定を推奨（90日以内）
#   - トークンは絶対にコミットしない
#
GITHUB_TOKEN=

# -----------------------------------------------------------------------------
# 1-2. GitHub Apps認証（エンタープライズ向け、オプション）
# -----------------------------------------------------------------------------
#
# より安全で細かい権限制御が必要な場合に使用。
# Personal Access Tokenと併用不可（どちらか一方のみ）。
#
# セットアップ:
#   1. GitHub → Settings → Developer settings → GitHub Apps
#   2. New GitHub App を作成
#   3. 必要な権限を設定
#   4. インストール後、以下の値を設定
#
# GITHUB_APP_ID=123456
# GITHUB_APP_INSTALLATION_ID=789012
# GITHUB_APP_PRIVATE_KEY_PATH=/path/to/private-key.pem
#
# または、Private Keyを直接環境変数で（非推奨、テスト用）:
# GITHUB_APP_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----"

# -----------------------------------------------------------------------------
# 1-3. GitHub Enterprise（オプション）
# -----------------------------------------------------------------------------
#
# GitHub Enterprise Serverを使用している場合、カスタムAPIエンドポイントを設定。
#
# GITHUB_API_URL=https://github.example.com/api/v3


# =============================================================================
# 2. データベース接続（必須）
# =============================================================================
#
# PostgreSQLデータベースへの接続設定。
#
# 📝 接続情報の管理方針:
#   以下の設定は docker-compose.yml で管理されています：
#     - DATABASE_HOST=postgres
#     - DATABASE_PORT=5432
#     - DATABASE_NAME=nagare
#     - DATABASE_USER=nagare_user
#
#   変更する場合は docker-compose.yml を編集してください。
#   このファイル（.env）には機密情報のみを記載します。

# データベース接続情報
# 以下の設定は connections.yml でデフォルト値が定義されていますが、
# docker-compose.yml での PostgreSQL 起動時に必要なため .env にも記載します
DATABASE_USER=nagare_user
DATABASE_NAME=nagare

# データベースパスワード（必須）
# setup-secrets.sh で自動生成されます
# または、手動で強力なパスワード（16文字以上）を設定
DATABASE_PASSWORD=


# =============================================================================
# 3. Airflow設定（必須）
# =============================================================================

# Airflow管理画面のパスワード（必須）
# ユーザー名: admin
# 推奨: 16文字以上の強力なパスワード
AIRFLOW_ADMIN_PASSWORD=

# Airflowのシークレットキー（必須）
# setup-secrets.sh で自動生成されます
# セッション暗号化に使用されるため、強力なランダム文字列が必要
AIRFLOW_SECRET_KEY=

# -----------------------------------------------------------------------------
# Airflow追加設定（オプション）
# -----------------------------------------------------------------------------
#
# AIRFLOW_ADMIN_USERNAME=admin
# AIRFLOW_ALERT_EMAIL=admin@example.com


# =============================================================================
# 4. Apache Superset設定（必須）
# =============================================================================

# Supersetのシークレットキー（必須）
# setup-secrets.sh で自動生成されます
# セッション暗号化に使用されるため、強力なランダム文字列が必要
SUPERSET_SECRET_KEY=


# =============================================================================
# 5. 開発環境設定（オプション）
# =============================================================================
#
# これらの設定は開発・テスト環境でのみ使用します。
# 本番環境では設定しないでください。

# モックデータベースの使用（開発環境のみ）
# true: MockDatabaseClientを使用（PostgreSQL不要）
# false: 本番用DatabaseClientを使用（デフォルト）
# USE_DB_MOCK=false

# モックデータベースのデータソース（USE_DB_MOCK=trueの場合）
# JSONファイルでリポジトリ情報を指定
# REPOSITORIES_JSON='[{"owner":"test","repo":"repo1"}]'


# =============================================================================
# 6. ポート設定（オプション、Docker環境）
# =============================================================================
#
# Docker Composeで使用するポート番号。
# ローカルでポート衝突がある場合のみ変更してください。
#
# 📝 注意: これらはdocker-compose.ymlでデフォルト値が設定されています。
#         通常は変更不要です。
#
# AIRFLOW_WEBSERVER_PORT=8080
# STREAMLIT_PORT=8501
# SUPERSET_PORT=8088


# =============================================================================
# 7. 他のCI/CDプラットフォーム（オプション）
# =============================================================================

# -----------------------------------------------------------------------------
# 7-1. Bitrise
# -----------------------------------------------------------------------------
#
# Bitriseからビルド情報を収集する場合に設定。
#
# 取得方法:
#   1. Bitrise → Account Settings → Security
#   2. Generate new token
#
# 必要な権限:
#   - Read access to builds
#
# BITRISE_TOKEN=

# -----------------------------------------------------------------------------
# 7-2. Xcode Cloud (App Store Connect API)
# -----------------------------------------------------------------------------
#
# Xcode Cloudからビルド情報を収集する場合に設定。
# App Store Connect APIを使用するため、API Keyの作成が必要。
#
# 取得方法:
#   1. App Store Connect (https://appstoreconnect.apple.com) にログイン
#   2. Users and Access → Keys → App Store Connect API
#   3. 新しいキーを作成（権限: App Manager または Admin）
#   4. Key ID, Issuer ID, Private Key (.p8ファイル) をダウンロード
#
# APPSTORE_KEY_ID=
# APPSTORE_ISSUER_ID=
#
# Private Keyの設定方法:
#   環境変数に直接P8ファイルの内容を設定（推奨）
#   複数行の場合はダブルクォートで囲む
#
#   例:
#   APPSTORE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----
#   MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQg...
#   -----END PRIVATE KEY-----"
#
# APPSTORE_PRIVATE_KEY=

# -----------------------------------------------------------------------------
# 7-3. 将来の拡張: GitLab / CircleCI（現在未実装）
# -----------------------------------------------------------------------------
#
# GitLabやCircleCI等からのデータ収集を有効にする場合（将来実装予定）
#
# GitLab:
#   取得方法: GitLab → User Settings → Access Tokens
#   必要なスコープ: api, read_api, read_repository
#
# GITLAB_TOKEN=
# GITLAB_URL=https://gitlab.com
#
# CircleCI:
#   取得方法: CircleCI → User Settings → Personal API Tokens
#
# CIRCLECI_TOKEN=
# CIRCLECI_API_URL=https://circleci.com/api


# =============================================================================
# 補足情報
# =============================================================================
#
# 📝 設定ファイル版（connections.yml）との使い分け:
#
#   環境変数（.env）:
#     ✅ Docker環境に最適
#     ✅ CI/CDパイプラインと統合しやすい
#     ✅ Secrets Managerと連携可能
#
#   設定ファイル（connections.yml）:
#     ✅ ローカル開発に便利
#     ✅ 複数環境の切り替えが容易
#     ✅ YAML形式で可読性が高い
#
#   どちらを使用するか:
#     - 本番環境: 環境変数（.env）を推奨
#     - 開発環境: お好みで選択可能
#
# 🔒 セキュリティベストプラクティス:
#
#   1. パスワード管理:
#      - 16文字以上の強力なランダムパスワードを使用
#      - setup-secrets.shでの自動生成を推奨
#      - パスワードマネージャーでの管理を検討
#
#   2. トークン管理:
#      - 定期的なローテーション（90日ごと推奨）
#      - 最小権限の原則（必要な権限のみ付与）
#      - トークン漏洩時の即座の無効化手順を確立
#
#   3. 本番環境:
#      - AWS Secrets Manager / Google Secret Manager の使用
#      - 環境変数の暗号化
#      - アクセスログの監視
#
# 📚 トラブルシューティング:
#
#   Q: "GitHub authentication not configured" エラー
#   A: GITHUB_TOKENが未設定です。上記1-1を参照して設定してください。
#
#   Q: "Database connection not configured" エラー
#   A: DATABASE_PASSWORDが未設定です。setup-secrets.shを実行してください。
#
#   Q: データが収集されない
#   A: 以下を確認:
#      1. GitHubトークンの権限（repo, read:org, workflow）
#      2. トークンの有効期限
#      3. Airflow DAGが有効化されているか
#
#   Q: ポート衝突エラー（"port is already allocated"）
#   A: 該当するポート設定をコメント解除して変更してください:
#      例: AIRFLOW_WEBSERVER_PORT=8081
#
# 📖 詳細ドキュメント:
#   - README.md: 環境構築手順
#   - docs/02_design/adr/002-connection-management-architecture.md
#   - docs/03_setup/database_setup.md
#   - docs/04_operation/error_handling.md
