# リポジトリガイドライン

## プロジェクト概要（Overview）

* `docs/00_overview.md`: プロダクトの目的とユーザーストーリー

## コーディング規約（Coding Style Guidelines）

* **Python:**
  * **Formatter & Linter:** `Ruff` を使用し、コードのフォーマット、リント、importの順序を統一的に管理する。
  * **型ヒント:** 原則としてすべての関数に型ヒントを付与する。
  * **型チェック:** `Pyright` を使用して静的型チェックを行う。

* **SQL:**
  * 可読性を高めるため、キーワードは大文字で記述する（`SELECT`, `FROM`, `WHERE`など）。
  * `WITH`句を用いて、複雑なクエリを論理的なステップに分割する。
  * プリペアーステートメントを使用する

* **命名規則:**
  * 各言語の標準的な慣習（Pythonはスネークケース、など）に従う。
  * 変数名や関数名は、その役割が明確にわかるように具体的かつ冗長さを厭わずに命名する。

* **コメント方針:**
  * 「何をしているか(What)」ではなく、「なぜそうしているのか(Why)」を記述する。複雑なビジネスロジックや、特定の技術的判断の背景などを記録する。

## ビルド＆テスト手順（Build & Test）

* **ローカル環境セットアップ:**
  * `docker-compose.yml` を用いて、Airflow, Superset, PostgreSQLの全てのコンポーネントをローカルで起動する。
  * 詳細な手順は `docker-compose up` コマンドを実行するだけである。

* **テスト実行:**
  * **Python:** `pytest` を用いてAirflow DAGのユニットテストを実行する。
    ```bash
    uv run pytest
    ```
  * **コード品質チェック:**
    ```bash
    # フォーマット
    uv run ruff format src/

    # リント
    uv run ruff check --fix src/

    # 型チェック
    uv run pyright src/
    ```
  * **CI/CDでのチェック内容:**
    - すべてのプルリクエストで、Lint、Formatter、ユニットテストが自動実行される。
    - これらのチェックをパスしない限り、`main`ブランチへのマージは許可されない。

## 知識＆ライブラリ（Knowledge & Library）

- **本プロジェクトのコアライブラリ:**
  - `Apache Airflow`: データ収集パイプラインの基本知識。特にDAGの定義方法。
  - `Apache Superset`: ダッシュボードの作成・編集方法、SQL Labの利用方法。
  - `PostgreSQL`:基本的なSQL構文。

## メンテナンス_ポリシー（Maintenance policy）

- 会話の中で繰り返し指示されたことがある場合は反映を検討すること
- 冗長だったり、圧縮の余地がある箇所を検討すること
- 簡潔でありながら密度の濃い文書にすること
- **仕様書との同期:** 機能追加や変更を行う際は、関連する仕様書 (`docs/01_requirements/` や `docs/02_design/`) も同時に更新することを推奨する。
