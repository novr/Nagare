# Nagare Connection Configuration
#
# ã“ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯Connectionæƒ…å ±ã‚’ç®¡ç†ã—ã€Airflow Connectionã¨ã—ã¦ã‚‚ä½¿ç”¨ã§ãã¾ã™ã€‚
# ä½¿ç”¨æ–¹æ³•ï¼š
#   1. cp connections.yml.sample connections.yml
#   2. å¿…è¦ãªé …ç›®ã‚’ç·¨é›†
#   3. Pythonã‚³ãƒ¼ãƒ‰ã§èª­ã¿è¾¼ã¿: ConnectionRegistry.from_file("connections.yml")
#
# ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ï¼ˆé‡è¦ï¼‰:
#   âŒ æ‚ªã„ä¾‹: ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›´æ¥è¨˜è¼‰
#      token: ghp_xxxxxxxxxxxx
#
#   âœ… è‰¯ã„ä¾‹: ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã¿
#      token: ${GITHUB_TOKEN}
#
#   ğŸ’¡ æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ:
#      - æ©Ÿå¯†æƒ…å ±ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰ã¯å¿…ãšç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã‚€
#      - ç’°å¢ƒå¤‰æ•°ã¯ .env ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†
#      - ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯æ§‹é€ çš„ãªè¨­å®šã®ã¿ã‚’è¨˜è¼‰
#      - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒå¿…è¦ãªå ´åˆ: ${VAR_NAME:-default_value}
#
# âš ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è­¦å‘Š:
#   - ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯æ©Ÿå¯†æƒ…å ±ã‚’ç›´æ¥è¨˜è¼‰ã—ãªã„
#   - .gitignoreã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
#   - æœ¬ç•ªç’°å¢ƒã§ã¯ç’°å¢ƒå¤‰æ•°ã®ä½¿ç”¨ã‚’æ¨å¥¨

# ==============================================================================
# æ¥ç¶šè¨­å®šï¼ˆãƒªã‚¹ãƒˆå½¢å¼ï¼‰
# ==============================================================================
# å„æ¥ç¶šã¯ conn_idï¼ˆä¸€æ„ã®è­˜åˆ¥å­ï¼‰ã¨ conn_typeï¼ˆæ¥ç¶šã‚¿ã‚¤ãƒ—ï¼‰ã‚’æŒã¡ã¾ã™ã€‚
# ã“ã®å½¢å¼ã«ã‚ˆã‚Šã€åŒã˜ã‚¿ã‚¤ãƒ—ã®è¤‡æ•°ã®æ¥ç¶šã‚’å®šç¾©ã§ãã¾ã™ã€‚
# ä¾‹: github_prod, github_dev, xcode_cloud_team_a, xcode_cloud_team_b

connections:
  # ==========================================================================
  # GitHubæ¥ç¶šè¨­å®š
  # ==========================================================================

  # GitHubæ¥ç¶šï¼ˆæ¨å¥¨ï¼šç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã¿ï¼‰
  - conn_id: github
    conn_type: github
    # Personal Access Tokenèªè¨¼
    # âœ… æ¨å¥¨: ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã¿ï¼ˆ.env ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ï¼‰
    token: ${GITHUB_TOKEN}
    # GitHub Enterpriseç”¨ã®ãƒ™ãƒ¼ã‚¹URLï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    # base_url: ${GITHUB_API_URL:-https://api.github.com}

  # è¤‡æ•°ã®GitHubæ¥ç¶šã‚’å®šç¾©ã™ã‚‹ä¾‹
  # - conn_id: github_enterprise
  #   conn_type: github
  #   token: ${GITHUB_ENTERPRISE_TOKEN}
  #   base_url: ${GITHUB_ENTERPRISE_URL}
  #
  # - conn_id: github_readonly
  #   conn_type: github
  #   # èª­ã¿å–ã‚Šå°‚ç”¨ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆã‚ˆã‚Šå®‰å…¨ï¼‰
  #   token: ${GITHUB_READONLY_TOKEN}

  # GitHub Appsèªè¨¼ã®ä¾‹ï¼ˆã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå‘ã‘ï¼‰
  # - conn_id: github_app
  #   conn_type: github
  #   app_id: ${GITHUB_APP_ID}
  #   installation_id: ${GITHUB_APP_INSTALLATION_ID}
  #   # private_keyã«ç›´æ¥è¨˜è¼‰
  #   # private_key: ${GITHUB_APP_PRIVATE_KEY}

  # ==========================================================================
  # Bitriseæ¥ç¶šè¨­å®š
  # ==========================================================================
  # âš ï¸ Bitriseã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€.envã«BITRISE_TOKENã‚’è¨­å®šã—ã¦ãã ã•ã„

  - conn_id: bitrise
    conn_type: bitrise
    # Personal Access Token
    # âœ… æ¨å¥¨: ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã¿ï¼ˆ.env ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ï¼‰
    api_token: ${BITRISE_TOKEN:-}
    # Bitrise API ãƒ™ãƒ¼ã‚¹URL
    # base_url: ${BITRISE_API_URL:-https://api.bitrise.io/v0.1}

  # ==========================================================================
  # Xcode Cloudæ¥ç¶šè¨­å®š
  # ==========================================================================
  # âš ï¸ Xcode Cloudã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€.envã«APPSTORE_*å¤‰æ•°ã‚’è¨­å®šã—ã¦ãã ã•ã„

  - conn_id: xcode_cloud
    conn_type: xcode_cloud
    # App Store Connect APIèªè¨¼æƒ…å ±
    # JWT (JSON Web Token)èªè¨¼ã‚’ä½¿ç”¨
    #
    # âœ… æ¨å¥¨: ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã¿ï¼ˆ.env ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ï¼‰
    #
    # å–å¾—æ–¹æ³•:
    #   1. App Store Connect (https://appstoreconnect.apple.com) ã«ãƒ­ã‚°ã‚¤ãƒ³
    #   2. Users and Access > Keys > App Store Connect API
    #   3. æ–°ã—ã„ã‚­ãƒ¼ã‚’ä½œæˆï¼ˆæ¨©é™: App Manager ã¾ãŸã¯ Adminï¼‰
    #   4. Key ID, Issuer ID, Private Key (.p8ãƒ•ã‚¡ã‚¤ãƒ«) ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

    # App Store Connect API Key ID
    key_id: ${APPSTORE_KEY_ID}

    # App Store Connect API Issuer ID
    issuer_id: ${APPSTORE_ISSUER_ID}

    # Private Key (P8å½¢å¼ã®å†…å®¹)
    # ç’°å¢ƒå¤‰æ•°ã«ç›´æ¥P8ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’è¨­å®š
    private_key: ${APPSTORE_PRIVATE_KEY}

    # App Store Connect API ãƒ™ãƒ¼ã‚¹URL
    # base_url: ${APPSTORE_API_URL:-https://api.appstoreconnect.apple.com/v1}

  # è¤‡æ•°ã®Appleé–‹ç™ºè€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ä¾‹
  # - conn_id: xcode_cloud_team_a
  #   conn_type: xcode_cloud
  #   key_id: ${APPSTORE_TEAM_A_KEY_ID}
  #   issuer_id: ${APPSTORE_TEAM_A_ISSUER_ID}
  #   private_key: ${APPSTORE_TEAM_A_PRIVATE_KEY}
  #
  # - conn_id: xcode_cloud_team_b
  #   conn_type: xcode_cloud
  #   key_id: ${APPSTORE_TEAM_B_KEY_ID}
  #   issuer_id: ${APPSTORE_TEAM_B_ISSUER_ID}
  #   private_key: ${APPSTORE_TEAM_B_PRIVATE_KEY}

  # ==========================================================================
  # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šè¨­å®š
  # ==========================================================================

  - conn_id: database
    conn_type: database
    # PostgreSQLæ¥ç¶šæƒ…å ±

    # Dockerç’°å¢ƒï¼ˆæ¨å¥¨ï¼‰:
    #   - host/portã¯ docker-compose.yml ã§ç®¡ç†ï¼ˆå›ºå®šå€¤ï¼‰
    #   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ã¿ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã¿
    host: postgres  # Docker Composeã®ã‚µãƒ¼ãƒ“ã‚¹åï¼ˆå›ºå®šï¼‰
    port: 5432      # ã‚³ãƒ³ãƒ†ãƒŠå†…ãƒãƒ¼ãƒˆï¼ˆå›ºå®šï¼‰
    database: ${DATABASE_NAME:-nagare}
    user: ${DATABASE_USER:-nagare_user}
    password: ${DATABASE_PASSWORD}

    # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒï¼ˆdocker-compose.ymlä¸ä½¿ç”¨ï¼‰:
    #   ã™ã¹ã¦ã‚’ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã‚€å ´åˆã¯ã‚³ãƒ¡ãƒ³ãƒˆè§£é™¤
    # host: ${DATABASE_HOST:-localhost}
    # port: ${DATABASE_PORT:-5432}
    # database: ${DATABASE_NAME:-nagare}
    # user: ${DATABASE_USER:-nagare_user}
    # password: ${DATABASE_PASSWORD}

    # Connection poolingè¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    # pool_size: 5
    # max_overflow: 10
    # pool_pre_ping: true


# ==============================================================================
# ä½¿ç”¨ä¾‹
# ==============================================================================
#
# ã€Dockerç’°å¢ƒï¼ˆæ¨å¥¨ï¼‰ã€‘
#
# 1. .env ãƒ•ã‚¡ã‚¤ãƒ«ã§æ©Ÿå¯†æƒ…å ±ã®ã¿ã‚’è¨­å®š:
#    GITHUB_TOKEN=ghp_xxxxxxxxxxxxx
#    BITRISE_TOKEN=your_bitrise_token
#    APPSTORE_KEY_ID=your_key_id
#    APPSTORE_ISSUER_ID=your_issuer_id
#    APPSTORE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----
#    MIGTAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBHkwdwIBAQQg...
#    -----END PRIVATE KEY-----"
#    DATABASE_PASSWORD=secure_password
#    # DATABASE_HOSTã¨PORTã¯ä¸è¦ï¼ˆdocker-compose.ymlã§ç®¡ç†ï¼‰
#
# 2. connections.yml ã§æ§‹é€ ã‚’å®šç¾©ï¼ˆã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰:
#    connections:
#      - conn_id: github
#        conn_type: github
#        token: ${GITHUB_TOKEN}
#      - conn_id: bitrise
#        conn_type: bitrise
#        api_token: ${BITRISE_TOKEN}
#      - conn_id: xcode_cloud
#        conn_type: xcode_cloud
#        key_id: ${APPSTORE_KEY_ID}
#        issuer_id: ${APPSTORE_ISSUER_ID}
#        private_key: ${APPSTORE_PRIVATE_KEY}
#      - conn_id: database
#        conn_type: database
#        host: postgres  # å›ºå®šå€¤ï¼ˆDocker Composeã®ã‚µãƒ¼ãƒ“ã‚¹åï¼‰
#        port: 5432      # å›ºå®šå€¤
#        password: ${DATABASE_PASSWORD}
#
# 3. Pythonã‚³ãƒ¼ãƒ‰ã§èª­ã¿è¾¼ã¿:
#    from nagare.utils.connections import ConnectionRegistry
#
#    # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿ï¼ˆç’°å¢ƒå¤‰æ•°ãŒè‡ªå‹•å±•é–‹ã•ã‚Œã‚‹ï¼‰
#    ConnectionRegistry.from_file("connections.yml")
#
#    # æ¥ç¶šã‚’å–å¾—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¥ç¶šã‚’è‡ªå‹•é¸æŠï¼‰
#    github_conn = ConnectionRegistry.get_github()
#    bitrise_conn = ConnectionRegistry.get_bitrise()
#    xcode_cloud_conn = ConnectionRegistry.get_xcode_cloud()
#    db_conn = ConnectionRegistry.get_database()
#
#    # ç‰¹å®šã®conn_idã‚’æŒ‡å®šã—ã¦å–å¾—
#    github_ro_conn = ConnectionRegistry.get("github_readonly")
#    xcode_team_a_conn = ConnectionRegistry.get("xcode_cloud_team_a")
#
# ã€ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒï¼ˆdocker-compose.ymlä¸ä½¿ç”¨ï¼‰ã€‘
#
# 1. .env ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã¹ã¦ã®è¨­å®š:
#    GITHUB_TOKEN=ghp_xxxxxxxxxxxxx
#    BITRISE_TOKEN=your_bitrise_token
#    APPSTORE_KEY_ID=your_key_id
#    APPSTORE_ISSUER_ID=your_issuer_id
#    APPSTORE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----..."
#    DATABASE_HOST=localhost  # ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã¯å¿…è¦
#    DATABASE_PORT=5432
#    DATABASE_PASSWORD=secure_password
#
# 2. connections.yml ã§ã™ã¹ã¦ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã¿:
#    connections:
#      - conn_id: database
#        conn_type: database
#        host: ${DATABASE_HOST:-localhost}
#        port: ${DATABASE_PORT:-5432}
#        password: ${DATABASE_PASSWORD}
#
# ==============================================================================
# è¤‡æ•°ã®æ¥ç¶šã‚’ä½¿ã„åˆ†ã‘ã‚‹ä¾‹
# ==============================================================================
#
# connections.yml:
#   connections:
#     - conn_id: github_prod
#       conn_type: github
#       token: ${GITHUB_PROD_TOKEN}
#
#     - conn_id: github_dev
#       conn_type: github
#       token: ${GITHUB_DEV_TOKEN}
#
#     - conn_id: github_ci
#       conn_type: github
#       token: ${GITHUB_CI_TOKEN}
#
# .env:
#   GITHUB_PROD_TOKEN=ghp_prod_xxxxx
#   GITHUB_DEV_TOKEN=ghp_dev_xxxxx
#   GITHUB_CI_TOKEN=ghp_ci_xxxxx
#
# ä½¿ç”¨æ–¹æ³•:
#   # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¥ç¶šï¼ˆæœ€åˆã«å®šç¾©ã•ã‚ŒãŸæ¥ç¶šï¼‰
#   github_conn = ConnectionRegistry.get_github()
#
#   # ç‰¹å®šã®conn_idã‚’æŒ‡å®š
#   prod_conn = ConnectionRegistry.get("github_prod")
#   dev_conn = ConnectionRegistry.get("github_dev")
#
# ==============================================================================
# ç’°å¢ƒå¤‰æ•°å±•é–‹ã®æ§‹æ–‡
# ==============================================================================
#
# åŸºæœ¬å½¢å¼:
#   ${VAR_NAME}              # ç’°å¢ƒå¤‰æ•° VAR_NAME ã®å€¤
#   ${VAR_NAME:-default}     # VAR_NAMEãŒæœªè¨­å®šã®å ´åˆã¯defaultã‚’ä½¿ç”¨
#
# ä¾‹:
#   host: ${DB_HOST}                    # DB_HOSTã®å€¤ã‚’ãã®ã¾ã¾ä½¿ç”¨
#   port: ${DB_PORT:-5432}              # DB_PORTãŒæœªè¨­å®šãªã‚‰5432
#   url: https://${API_HOST}/api/v1     # æ–‡å­—åˆ—ã®ä¸€éƒ¨ã¨ã—ã¦å±•é–‹
#
# ==============================================================================
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
# ==============================================================================
#
# âœ… DO:
#   - æ©Ÿå¯†æƒ…å ±ã¯å¿…ãšç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã‚€
#   - .env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ .gitignore ã«è¿½åŠ 
#   - æœ¬ç•ªç’°å¢ƒã§ã¯ Secrets Manager ã‚’ä½¿ç”¨
#   - ãƒˆãƒ¼ã‚¯ãƒ³ã¯å®šæœŸçš„ã«ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
#
# âŒ DON'T:
#   - ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›´æ¥ connections.yml ã«è¨˜è¼‰
#   - connections.yml ã‚’ Git ã«ã‚³ãƒŸãƒƒãƒˆï¼ˆæ©Ÿå¯†æƒ…å ±ãŒã‚ã‚‹å ´åˆï¼‰
#   - åŒã˜ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¤‡æ•°ç’°å¢ƒã§ä½¿ã„å›ã™
#
# ==============================================================================
# ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
# ==============================================================================
#
# Q: ç’°å¢ƒå¤‰æ•°ãŒå±•é–‹ã•ã‚Œãªã„
# A: ${VAR_NAME} ã®æ§‹æ–‡ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã‚¹ãƒšãƒ¼ã‚¹ã¯ä¸è¦ã§ã™ã€‚
#
# Q: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒä½¿ã‚ã‚Œãªã„
# A: ${VAR_NAME:-default} ã®æ§‹æ–‡ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆã‚³ãƒ­ãƒ³ã¨ãƒã‚¤ãƒ•ãƒ³ï¼‰ã€‚
#
# Q: è¤‡æ•°ã®æ¥ç¶šã‚’å®šç¾©ã—ãŸãŒä½¿ãˆãªã„
# A: ConnectionRegistry.get("conn_id") ã§ç‰¹å®šã®conn_idã‚’æŒ‡å®šã—ã¦å–å¾—ã—ã¦ãã ã•ã„ã€‚
#    ã¾ãŸã¯ã€get_github()ãªã©ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¥ç¶šï¼ˆæœ€åˆã«å®šç¾©ã•ã‚ŒãŸæ¥ç¶šï¼‰ã‚’è¿”ã—ã¾ã™ã€‚
#
# Q: Xcode Cloudã®Private KeyãŒèªè­˜ã•ã‚Œãªã„
# A: Private Keyã¯æ”¹è¡Œã‚’å«ã‚€è¤‡æ•°è¡Œã®æ–‡å­—åˆ—ã§ã™ã€‚.envãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯
#    ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã¿ã€\nã§æ”¹è¡Œã‚’è¡¨ç¾ã™ã‚‹ã‹ã€ãƒ’ã‚¢ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå½¢å¼ã‚’
#    ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚ã¾ãŸã¯ã€private_key_pathã§ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹
#    æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚
